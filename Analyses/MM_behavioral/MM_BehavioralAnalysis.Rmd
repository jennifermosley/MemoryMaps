---
title: "R Notebook"
output: html_notebook
---

## Prepare for Analysis and Visualizations

```{r}
#library(groundhog)

pkgs <-  c("tidyverse","here", "lmerTest", "sjPlot","broom.mixed", "kableExtra", "ggeffects", "gt", "brms", "bayestestR","ggdist", "pheatmap", "heatmaply","pheatmap","gplots","RColorBrewer", "tm", "wordcloud", "psych", "wesanderson","patchwork", "broom.mixed", "dplyr", "gtsummary")

pacman::p_load("tidyverse","here", "lmerTest", "sjPlot","broom.mixed", "kableExtra", "ggeffects", "gt", "brms", "bayestestR","ggdist", "pheatmap", "heatmaply","pheatmap","gplots","RColorBrewer", "tm", "wordcloud", "psych", "wesanderson","patchwork", "broom.mixed", "dplyr", "gtsummary","ordinal","r2glmm")

update.packages(pkgs)

library(lmerTest)
library(dplyr)

# Useful resources Jake imported from S2 analysis
devtools::source_url("https://raw.githubusercontent.com/JacobElder/MiscellaneousR/master/corToOne.R")
devtools::source_url("https://raw.githubusercontent.com/JacobElder/MiscellaneousR/master/plotCommAxes.R")
devtools::source_url("https://raw.githubusercontent.com/JacobElder/MiscellaneousR/master/named.effects.ref.R")

# Import fullLong includes memories for each subject
fullLong <- read.csv("~/GitLab/SecondYearProject/MemoryMaps/Data/processed/fullLong.csv")
fullLong <- fullLong[-1, ]

# Import fullShort - doesn't include memories for each subject
fullShort <- read.csv("~/GitLab/SecondYearProject/MemoryMaps/Data/processed/fullShort.csv")
fullShort <- fullShort[-1, ]
# rankData <- arrow::read_parquet(here("RepData/rankings2.parquet"))

# Join fullLong and fullShort
fullData <- fullLong %>% full_join(fullShort, by = c("subID"))
fullData$subID <- as.factor(fullData$subID)
fullData <- fullData[ ,-1]

# Download fullData file for separate analysis (onset file creation)
write.csv(fullData,"~/GitLab/SecondYearProject/MemoryMaps/Data/processed/fullData.csv")

# pal1 <-n colorRampPalette(brewer.pal(11,"BrBG"))(227)
pal <- colorRampPalette(wes_palette("Zissou1", 5))(length(unique(fullLong$subID)))
```

# Linear Mixed Models (and some descriptives)

--------------------------------------------------------------------------------

# Centrality Predictors (A priori)

## From rep pipeline: valence (pos/neg) \~ degree centrality

### NOTE: this data was not collected through memory ratings, but were collected

### from the subject in the scanner.

```{r}
m <- lmer(scale(positive) ~  scale(outdegree) + scale(indegree) + numID + ( scale(outdegree) + scale(indegree) | subID), data=fullData)

tbl_regression(m) %>% as_gt()
# Indegree (counterfactually-central, such that other memories would not have happened without the target memory) memories closely predict self-reported positivity of memories)

m <-lmer( scale(vad_pos) ~  scale(strengthOut) + scale(strengthIn) + numID + ( scale(strengthOut) + scale(strengthIn) | subID), data=fullData)

tbl_regression(m) %>% as_gt()
```

```{r}
m<-lmer( scale(negative) ~  scale(outdegree) + scale(indegree) + numID + ( scale(outdegree) + scale(indegree) | subID), data=fullData)

tbl_regression(m) %>% as_gt()
#
```

```{r}
m<-lmer( scale(vad_pos) ~  scale(outdegree) + scale(indegree) + numID + ( scale(outdegree) + scale(indegree) | subID), data=fullData)
tbl_regression(m) %>% as_gt()
r2beta(m)
```

```{r}
m<-lmer( scale(vad_pos) ~  scale(strengthOut) + scale(strengthIn) + numID + scale(length) + ( scale(strengthOut) + scale(strengthIn) | subID), data=fullData)
tbl_regression(m) %>% as_gt()
```

## Does degree centrality predict memory IMPORTANCE?

\>\>\>

```{r}
m <-lmer( scale(importance) ~  scale(outdegree) + scale(indegree) + numID + ( scale(outdegree) + scale(indegree) | subID), data=fullData)
tbl_regression(m) %>% as_gt()
# Personal importance of the memory is equally associated with outdegree and indegree within the memory network

# StrengthIn/Out analyses from rep pipeline
# m<-lmer( scale(importance) ~  scale(strengthOut) + scale(strengthIn) + numID + ( scale(strengthOut) + scale(strengthIn) | subID), data=fullData)
# tbl_regression(m) %>% as_gt()
```

## Does degree centrality predict memory CLARITY?

\>\>\>

```{r}
m<-lmer( scale(clear) ~  scale(outdegree) + scale(indegree) + numID + ( scale(outdegree) + scale(indegree) | subID), data=fullData)
tbl_regression(m) %>% as_gt()

# StrengthIn/Out analyses from rep pipeline
# m<-lmer( scale(clear) ~  scale(strengthOut) + scale(strengthIn) + numID + ( scale(strengthOut) + scale(strengthIn) | subID), data=fullData)
# tbl_regression(m) %>% as_gt()
```

## Does degree centrality predict memory AGENCY?

\>\>\>

```{r}
m<-lmer( scale(agency) ~  scale(outdegree) + scale(indegree) + numID + ( scale(outdegree) + scale(indegree) | subID), data=fullData)
tbl_regression(m) %>% as_gt()

# StrengthIn/Out analyses from rep pipeline
# m<-lmer( scale(agency) ~  scale(strengthOut) + scale(strengthIn) + numID + ( scale(strengthOut) + scale(strengthIn) | subID), data=fullData)
# tbl_regression(m) %>% as_gt()
```

## Does degree centrality predict memory EASE OF RECALL?

\>\>\>

```{r}
m<-lmer( scale(easy) ~  scale(outdegree) + scale(indegree) + numID + ( scale(outdegree) + scale(indegree) | subID), data=fullData)
tbl_regression(m) %>% as_gt()

# StrengthIn/Out analyses from rep pipeline
# m<-lmer( scale(Easy) ~  scale(strengthOut) + scale(strengthIn) + numID + ( scale(strengthOut) + scale(strengthIn) | subID), data=fullData)
# tbl_regression(m) %>% as_gt()
```

## Does degree centrality predict memory TRANSFORMATIVENESS?

\>\>\>

```{r}
m<-lmer( scale(transformativeness) ~  scale(outdegree) + scale(indegree) + numID + ( scale(outdegree) + scale(indegree) | subID), data=fullData)
tbl_regression(m) %>% as_gt()

# StrengthIn/Out analyses from rep pipeline
# m<-lmer( scale(transformativeness) ~  scale(strengthOut) + scale(strengthIn) + numID + ( scale(strengthOut) + scale(strengthIn) | subID), data=fullData)
# tbl_regression(m) %>% as_gt()
```

## Does degree centrality predict memory CHANGEABILITY?

\>\>\>

```{r}
m<-lmer( scale(change) ~  scale(outdegree) + scale(indegree) + numID + ( scale(outdegree) + scale(indegree) | subID), data=fullData)
tbl_regression(m) %>% as_gt()

# StrengthIn/Out analyses from rep pipeline
# m<-lmer( scale(change) ~  scale(strengthOut) + scale(strengthIn) + numID + ( scale(strengthOut) + scale(strengthIn) | subID), data=fullData)
# tbl_regression(m) %>% as_gt()
```

# Density (Post-Hoc)

## Descriptives

```{r}
dens <- fullData[, c(1,46)] # For descriptives and later onset file usage
dens <- unique(dens) # Restructure to compare between networks (one dens value per subject)

dens_mean <- mean(dens$dense) # Average network density
dens_sd <- sd(dens$dense) # Standard deviation from density average

dens_freq <- hist(dens$dense) # Distribution of network density across subject networks
dens$density_scaled <- as.vector(scale(dens$dense)) # Scaled density values for lme

write.csv(dens,"densityDf.csv") # Write file to csv for later onset files
```

## Inferences (Linear Mixed Effects Model)

### Does network density predict memory IMPORTANCE?

```{r}
m<-lmer( scale(importance) ~  scale(edgeTot) + numID + ( scale(edgeTot) | subID), data=fullData)
tbl_regression(m) %>% as_gt()
```

### Does network density predict memory CLARITY?

```{r}
m<-lmer( scale(clear) ~  scale(edgeTot) + numID + ( scale(edgeTot) | subID), data=fullData)
tbl_regression(m) %>% as_gt()
```

### Does network density predict memory AGENCY?

```{r}
m<-lmer( scale(agency) ~  scale(edgeTot) + numID + ( scale(edgeTot) | subID), data=fullData)
tbl_regression(m) %>% as_gt()
```

### Does network density predict memory EASE OF RECALL?

```{r}
m<-lmer( scale(easy) ~  scale(edgeTot) + numID + ( scale(edgeTot) | subID), data=fullData)
tbl_regression(m) %>% as_gt()
```

### Does network density predict memory CHANGEABILITY?

```{r}
m<-lmer( scale(change) ~  scale(edgeTot) + numID + ( scale(edgeTot) | subID), data=fullData)
tbl_regression(m) %>% as_gt()
```

### Does network density predict memory TRANSFORMATIVENESS?

```{r}
m<-lmer( scale(transformativeness) ~  scale(edgeTot) + numID + ( scale(edgeTot) | subID), data=fullData)
tbl_regression(m) %>% as_gt()
```


# Edge Total (Post-Hoc)

## Descriptives

```{r}
edgTotal <- fullData[, c(1,45)] # For descriptives and later onset file usage
edgTotal <- unique(edgTotal) # Restructure to compare between networks (one dens value per subject)
edgTotal$edg_scaled <- as.vector(scale(edgTotal$edgeTot)) # Scaled density values for lme

edgTotal_mean <- mean(edgTotal$edgeTot) # Average network density
edgTotal_sd <- sd(edgTotal$edgeTot) # Standard deviation from density average

edgTotal_freq <- hist(edgTotal$edgeTot) # Distribution of network density across subject networks

write.csv(edgTotal,"edgeTotalDf.csv") # Write file to csv for later onset files
```

## Inferences (Linear Mixed Effects Model)

### Does network edge total predict memory IMPORTANCE?

```{r}
m<-lmer( scale(change) ~  scale(dense) + numID + ( scale(dense) | subID), data=fullData)
tbl_regression(m) %>% as_gt()
```

### Does network edge total predict memory CLARITY?

```{r}
m<-lmer( scale(clear) ~  scale(dense) + numID + ( scale(dense) | subID), data=fullData)
tbl_regression(m) %>% as_gt()

```

### Does network edge total predict memory AGENCY?

```{r}
m<-lmer( scale(agency) ~  scale(dense) + numID + ( scale(dense) | subID), data=fullData)
tbl_regression(m) %>% as_gt()
```

### Does network edge total predict memory EASE OF RECALL?

```{r}
m<-lmer( scale(easy) ~  scale(dense) + numID + ( scale(dense) | subID), data=fullData)
tbl_regression(m) %>% as_gt()
```

### Does network edge total predict memory CHANGEABILITY?

```{r}
m<-lmer( scale(change) ~  scale(dense) + numID + ( scale(dense) | subID), data=fullData)
tbl_regression(m) %>% as_gt()
```


### Does network edge total predict memory TRANSFORMATIVENESS?

```{r}
m<-lmer( scale(transformativeness) ~  scale(dense) + numID + ( scale(dense) | subID), data=fullData)
tbl_regression(m) %>% as_gt()
```


# Visualizations

## Fundamental (FUND)

```{r}
mF<-lmer( scale(Fund) ~  scale(outdegree) + scale(indegree) + numID + ( scale(outdegree) + scale(indegree) | subID), data=fullData)
tidy(mF)


tbl_regression(mF) %>% as_gt()
ggpredict(m, terms="outdegree") %>% plot(colors="orange") +
  labs(
    x = "Outdegree Centrality",
    y = "Fundamental (Study 2)",
  )
```

## Representative (REP)

```{r}
mR<-lmer( scale(Rep) ~  scale(outdegree) + scale(indegree) + numID + ( scale(outdegree) + scale(indegree) | subID), data=fullData)
tidy(mR)

tbl_regression(mR) %>% as_gt()
ggpredict(m, terms="outdegree") %>% plot(colors="blue") +
  labs(
    x = "Outdegree Centrality",
    y = "Representative (Study 2)",
  )
```

## Changeability (CHAN)

```{r}
mC<-lmer( scale(Chan) ~  scale(outdegree) + scale(indegree) + numID + ( scale(outdegree) + scale(indegree) | subID), data=fullData)
tidy(mC)


tbl_regression(mC) %>% as_gt()
ggpredict(m, terms="outdegree") %>% plot(colors="brown") +
  labs(
    x = "Outdegree Centrality",
    y = "Transformative (Study 2)",
  )
```
